---
import { Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import heroPlaceholder from '../../assets/hero-placeholder.jpg';

interface Props {
  /** Sanity image URL (string) or imported local image */
  image?: string | ImageMetadata;
  imageAlt?: string;
  variant?: 'default' | 'inner';
  /** View Transition name for the background image */
  imageTransitionName?: string;
  class?: string;
}

const { image, imageAlt = '', variant = 'default', imageTransitionName, class: className } = Astro.props;

// Always show a background — use placeholder when no image provided
const resolvedImage = image || heroPlaceholder;
---

<section class:list={['page-hero', 'page-hero--has-image', { 'page-hero--inner': variant === 'inner' }, className]}>
  <div class="page-hero__bg" style={imageTransitionName ? `view-transition-name: ${imageTransitionName}` : undefined}>
    <Picture
      src={resolvedImage}
      alt={imageAlt}
      width={1920}
      height={1080}
      widths={[640, 1024, 1440, 1920]}
      sizes="100vw"
      formats={['avif', 'webp']}
      fallbackFormat="jpg"
      quality={80}
      loading="eager"
      class="page-hero__bg-img"
    />
  </div>

  <div class="page-hero__container">
    <div class="page-hero__content">
      <slot />
    </div>
  </div>
</section>

<style>
  /* ============================================
     PAGE HERO — Unified hero layout
     Full-bleed background, vertically centered,
     left-aligned content.
     ============================================ */
  .page-hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    overflow: hidden;
    background: var(--bg-primary);
  }

  /* --- Inner page variant: shorter hero --- */
  .page-hero--inner {
    min-height: 75vh;
  }

  /* --- Background image layer --- */
  .page-hero__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .page-hero__bg :global(picture),
  .page-hero__bg :global(img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .page-hero__bg::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(10, 10, 10, 0.65);
    pointer-events: none;
    z-index: 1;
  }

  /* Inner pages: directional gradient — heavy left, transparent right */
  .page-hero--inner .page-hero__bg::after {
    background: linear-gradient(
      to right,
      rgba(10, 10, 10, 0.95) 40%,
      rgba(10, 10, 10, 0.4) 100%
    );
  }

  /* --- Content layer --- */
  .page-hero__container {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 1440px;
    margin: 0 auto;
    padding: 6rem 1.5rem 3rem;
  }

  .page-hero__content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    max-width: 800px;
  }

  /* --- Slot content: H1 --- */
  .page-hero__content :global(h1) {
    font-family: var(--font-display);
    font-size: clamp(3rem, 8vw, 5.5rem);
    font-weight: 500;
    line-height: 1.05;
    color: var(--text-primary);
    margin: 0;
  }

  /* --- Slot content: Description --- */
  .page-hero__content :global(.page-hero__description) {
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 300;
    line-height: 1.7;
    color: var(--text-on-image);
    margin: 0;
    max-width: 600px;
  }

  /* --- Slot content: Actions --- */
  .page-hero__content :global(.page-hero__actions) {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1.5rem;
    margin-top: 0.5rem;
  }

  /* ============================================
     RESPONSIVE
     ============================================ */

  /* Mobile: uniform overlay for readability (no gradient) */
  @media (max-width: 767px) {
    .page-hero__bg::after,
    .page-hero--inner .page-hero__bg::after {
      background: rgba(10, 10, 10, 0.8);
    }

    .page-hero__content {
      padding-top: 2rem;
    }
  }

  /* Tablet: 768px+ */
  @media (min-width: 768px) {
    .page-hero__container {
      padding: 8rem 2.5rem 4rem;
    }

    .page-hero__content {
      gap: 1.75rem;
    }

    .page-hero__content :global(.page-hero__description) {
      font-size: 1.0625rem;
    }
  }

  /* Desktop: 1024px+ — flex-center the container */
  @media (min-width: 1024px) {
    .page-hero__container {
      padding: 0 3rem;
      display: flex;
      align-items: center;
      min-height: 100vh;
    }

    .page-hero--inner .page-hero__container {
      min-height: 75vh;
    }

    .page-hero__content {
      gap: 2rem;
    }

    .page-hero__content :global(.page-hero__description) {
      font-size: 1.125rem;
    }

    .page-hero__content :global(.page-hero__actions) {
      gap: 2rem;
      margin-top: 1rem;
    }
  }

  /* Large desktop: 1280px+ */
  @media (min-width: 1280px) {
    .page-hero__container {
      padding: 0 5rem;
    }
  }
</style>
