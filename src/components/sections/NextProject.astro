---
import { urlFor } from '../../lib/sanity';
import SectionLabel from '../ui/SectionLabel.astro';
import { MoveRight } from '@lucide/astro';

interface Props {
  project?: {
    title?: string;
    slug?: { current: string };
    client?: string;
    thumbnailImage?: any;
  };
}

const { project } = Astro.props;

let imageUrl: string | undefined;
if (project?.thumbnailImage) {
  try {
    imageUrl = urlFor(project.thumbnailImage).width(960).height(640).format('webp').url();
  } catch { /* no image */ }
}

const hasProject = project?.title && project?.slug;
---

{hasProject && (
  <section class="next-project">
    <a href={`/work/${project.slug!.current}/`} class="next-project__link">
      <div class="next-project__container">
        <div class="next-project__text">
          <SectionLabel text="Next Project" />
          <h2 class="next-project__title">{project.title}</h2>
          {project.client && (
            <span class="next-project__client">{project.client}</span>
          )}
          <span class="next-project__arrow">
            <MoveRight size={24} />
          </span>
        </div>
        <div class="next-project__image-wrap">
          {imageUrl ? (
            <Fragment>
              <img
                src={imageUrl}
                alt={project.title || ''}
                width="960"
                height="640"
                loading="lazy"
                decoding="async"
                class="next-project__img"
              />
              <div class="next-project__reveal" />
            </Fragment>
          ) : (
            <div class="next-project__placeholder" />
          )}
        </div>
      </div>
    </a>
  </section>
)}

<style>
  .next-project {
    padding: 6rem 0;
    background: var(--bg-primary);
    border-top: 1px solid var(--border);
  }

  .next-project__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .next-project__link:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: -2px;
  }

  .next-project__container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: center;
  }

  /* ---- Text side ---- */
  .next-project__text {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .next-project__title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 500;
    line-height: 1.1;
    color: var(--text-primary);
    margin: 0;
    transition: color 0.3s ease;
  }

  .next-project__link:hover .next-project__title {
    color: var(--accent);
  }

  .next-project__client {
    font-family: var(--font-body);
    font-size: 0.9375rem;
    font-weight: 300;
    color: var(--text-secondary);
  }

  .next-project__arrow {
    display: inline-flex;
    color: var(--text-muted);
    transition: color 0.3s ease, transform 0.3s ease;
  }

  .next-project__link:hover .next-project__arrow {
    color: var(--accent);
    transform: translateX(8px);
  }

  /* ---- Image side ---- */
  .next-project__image-wrap {
    position: relative;
    width: 100%;
    aspect-ratio: 3 / 2;
    overflow: hidden;
  }

  .next-project__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .next-project__link:hover .next-project__img {
    transform: scale(1.05);
  }

  /* ---- Reveal overlay ---- */
  .next-project__reveal {
    position: absolute;
    inset: 0;
    background: var(--bg-primary);
    transform-origin: right;
    transform: scaleX(1);
    transition: transform 0.6s cubic-bezier(0.77, 0, 0.175, 1);
  }

  .next-project__link:hover .next-project__reveal {
    transform: scaleX(0);
  }

  .next-project__placeholder {
    width: 100%;
    height: 100%;
    background: var(--bg-tertiary);
  }

  /* ---- Reduced motion ---- */
  @media (prefers-reduced-motion: reduce) {
    .next-project__reveal {
      transform: scaleX(0);
      transition: none;
    }

    .next-project__img {
      transition: none;
    }

    .next-project__title {
      transition: none;
    }

    .next-project__arrow {
      transition: none;
    }
  }

  /* ---- Responsive ---- */
  @media (max-width: 768px) {
    .next-project {
      padding: 4rem 0;
    }

    .next-project__container {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .next-project__reveal {
      transform: scaleX(0);
    }
  }

  @media (max-width: 480px) {
    .next-project {
      padding: 3rem 0;
    }

    .next-project__container {
      padding: 0 1rem;
    }
  }
</style>
